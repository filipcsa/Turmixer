<!DOCTYPE html>
<html>
    <head>
        <title>Turmixer</title>
        <style>
            body {
                margin: 0;
                padding: 0;
            }
            main {
                font-family: Arial, Helvetica, sans-serif;
                width: 100vw;
                height: 40em;
                margin: 0 auto;
                display: flex;
            }

            .left {
                text-align: center;
                background-color: rgb(245, 245, 245);
                width: 15em;
                height: 100%;
                display: block;
                z-index: 0;
                transition:margin 0.5s ease-out;
            }
            .left.toggled {
                margin-left: -15em;
            }
            @media (max-width: 900px) {
                .left {
                    margin-left: -15em;
                }
                .left.toggled {
                    margin-left: 0em;
                }
            }
            .left ul {
                margin: 0;
                padding: 0;
                list-style-type: none;
            }

            .playlists li {
                padding-top: 0.5em;
                padding-bottom: 0.5em;
                font-size: 1.2em;
                background-color: rgb(243, 243, 243);
                border-top-style: solid;
                border-width: 1px;
                border-color: rgb(109, 119, 119);
            }

            .playlists li.selected {
                font-weight: bold;
                background-color: rgb(212, 212, 212);
            }

            .playlists li:hover {
                cursor: pointer;
                background-color: rgb(212, 212, 212);
            }

            .right {
                background-color: green;
                flex-grow: 1;
                display: flex;
                flex-direction: column;
            }

            .upper {
                height: 5em;
            }

            .player {
                background-color: steelblue;
                display: flex;
                align-items: center;
            }


            .playlistToggle {
                background-image: url("icons/playlist_n.svg");
                cursor: pointer;
                background-repeat: 0 0;
                margin-left: 1em;
                width: 3.5em;
                height: 3.5em;
            }

            .playlistToggle:hover {
                background-image: url("icons/playlist_h.svg");
            }

            .selectedPlaylist {
                background-color: dimgrey;
                flex-grow: 1;
            }

            h1 {
                margin: 0;
                padding-top: 0.6em;
                overflow: clip;
                font-family:'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
                font-size: 2em;
            }
            footer {
                font-size: 0.7em;
                margin-top: 0.5em;
                text-align: center;
            }

        </style>
    </head>

    <body>
        <main>
            <nav class="left">
                <div class="upper">
                        <h1>Playlists</h1>
                </div>
                <ul class="playlists">

                </ul>
            </nav>
            <div class="right">
                <div class="upper player">
                    <audio>
                    </audio>
                    <div class="playlistToggle">
                        Toggle
                    </div>
                    Player here
                </div>
                <div class="selectedPlaylist" ondrop="dropHandler(event);" ondragover="dragOverHandler(event);">
                    Selected playlist here
                </div>
            </div>
        </main>
        <footer>
            Icons made by <a href="https://www.flaticon.com/authors/google" title="Google">Google</a> from <a href="https://www.flaticon.com/" 
                title="Flaticon">www.flaticon.com</a> is licensed by <a href="http://creativecommons.org/licenses/by/3.0/"title="Creative Commons BY 3.0" target="_blank">CC 3.0 BY</a>
        </footer>
    </body>

    <script>

        // some global variables, all the playlists and the selected one, some elements i need later
        // and the audio
        var playlists = [];
        var selectedPlaylist = null;
        var selectedPlaylistDiv = document.querySelector('.selectedPlaylist');
        var audio = document.querySelector('audio');

        // logic for toggling the playlist menu od the left
        var playlistToggleBtn = document.querySelector('.playlistToggle');
        playlistToggleBtn.addEventListener('click', togglePlaylist, false);
        function togglePlaylist() {
            let leftMenu = document.querySelector('.left');
            leftMenu.classList.toggle('toggled');

        }

        /** A class to represent a playlist
        it consists of a title and a list of tracks (their storage on HD) **/
        class Playlist {
            constructor(title) {
                this.title = title;
                this.tracks = [];
                this.selectedTrack = null;

                // create list item, add event listener and add to DOM
                this.li = document.createElement('li');
                this.li.innerText = title;
                this.li.addEventListener('click', this.onPlaylistClicked.bind(this), false);
                let playlistsUL = document.querySelector('.playlists');
                playlistsUL.appendChild(this.li);
                console.log(playlistsUL);
            }
            
            // when this playlist is clicked
            onPlaylistClicked() {
                if (selectedPlaylist != null) {
                    selectedPlaylist.li.classList.remove('selected');
                }    
                this.li.classList.add('selected');
                selectedPlaylist = this;
                console.log(`${this.title} clicked!`);
                selectedPlaylistDiv.innerHTML = "";
                this.tracks.forEach(this.displayTrack.bind(this));
            }

            // displays the track and adds event listener to it
            displayTrack(track) {
                let el = document.createElement('li');
                el.innerText = track;
                el.track = track;
                el.addEventListener('click', this.onTrackClicked, false);
                selectedPlaylistDiv.appendChild(el);
                console.log(track);
            }

            onTrackClicked(event) {
                console.log(event.target.track);
                audio.src = event.target.track;
                audio.play();
                console.log("Track clicked");
            }

            // method to add tracks, can add track song or array of tracks
            addSong(path) {
                if (Array.isArray(path)) {
                    this.tracks = this.tracks.concat(path);
                }
                else { 
                    this.tracks.push(path);
                }
            }
            
            // function to save the current playlist to local storage
            saveToLS() {
                localStorage.setItem(this.title, JSON.stringify(this));
            }
        }

        // Drag and drop based on MDN example
        function dropHandler(ev) {
            ev.preventDefault();
            console.log("File dropped");
            if (ev.dataTransfer.items) {
                // Use DataTransferItemList interface to access the file(s)
                for (var i = 0; i < ev.dataTransfer.items.length; i++) {
                    // If dropped items aren't files, reject them
                    if (ev.dataTransfer.items[i].kind === 'file') {
                        var file = ev.dataTransfer.items[i].getAsFile();
                        f = URL.createObjectURL(file);
                        console.log(f);
                        audio.src = f;
                        audio.play();
                        
                        console.log('... file[' + i + '].name = ' + file.name);
                    }
                }
            } else {
                // Use DataTransfer interface to access the file(s)
                for (var i = 0; i < ev.dataTransfer.files.length; i++) {
                console.log('... file[' + i + '].name = ' + ev.dataTransfer.files[i].name);
                }
            }

        }

        function dragOverHandler(ev) {
            console.log('File(s) in drop zone'); 

            // Prevent default behavior (Prevent file from being opened)
            ev.preventDefault();
        }


        // some initial playlists for testing
        const p1 = new Playlist('Rock');
        const p2 = new Playlist('Electro');
        p1.addSong(['https://www.bensound.org/bensound-music/bensound-anewbeginning.mp3', 
        'https://www.bensound.org/bensound-music/bensound-punky.mp3', 
        'https://www.bensound.org/bensound-music/bensound-goinghigher.mp3', 
        'https://www.bensound.org/bensound-music/bensound-beyondtheline.mp3', 
        'https://www.bensound.org/bensound-music/bensound-rumble.mp3']);
        p2.addSong(['song1', 'song2', 'song3', 'song4', 'song5']);
        playlists.push(p1);
        playlists.push(p2);

        function displayAvailablePlaylists() {

        }

        function initPlaylists() {
            JSON.parse(localStorage.getItem('playlists'));
        }
    </script>
</html>